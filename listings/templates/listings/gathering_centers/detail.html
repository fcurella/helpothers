{% extends 'base.html' %}
{% load i18n static leaflet_tags %}

{% block title %}{% trans 'Gathering Center' %}: {{ object.city }} | {{ block.super }}{% endblock %}

{% block extrahead %}
    {% leaflet_js %}
    {% leaflet_css %}
{% endblock extrahead %}

{% block content %}
    <section class="bg-primary" id="centers">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    {% if object.author == user %}
                    <a href="{% url 'gathering-center-update' object.pk %}" class="btn btn-default">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        {% trans "Edit this Gathering Center" %}
                    </a>
                    {% endif %}
                    <h1>
                        {{ object.city }} -
                        {% if object.location_name %}
                            {{ object.location_name }}
                        {% else %}
                            {{ object.address }}
                        {% endif %}
                    </h1>
                    {% if object.hours %}
                        <p>{{ object.hours }}</p>
                    {% endif %}
                    {% if object.geoposition %}
                        {% leaflet_map "main" callback="main_map_init" %}
                    {% endif %}
                </div>
                <div class="col-lg-8 col-lg-offset-2">
                    {% if object.most_needed %}
                        <h2>{% trans "Most Needed" %}</h2>
                        {{ object.most_needed }}
                    {% endif %}
                    {% if object.contact %}
                        <h2>{% trans "Contact" %}</h2>
                        {{ object.contact }}
                    {% endif %}
                    {% if object.description %}
                        <h2>{% trans "About" %}</h2>
                        {{ object.description }}
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript">
        var greenIcon = L.icon({
            iconUrl: '{% static "img/map-icon.png" %}',
            shadowUrl: '{% static "img/map-icon-shadow.png" %}',

            iconSize:     [64, 58], // size of the icon
            shadowSize:   [76, 45], // size of the shadow
            iconAnchor:   [21, 58], // point of the icon which will correspond to marker's location
            shadowAnchor: [13, 45],  // the same for the shadow
            popupAnchor:  [-42, -58] // point from which the popup should open relative to the iconAnchor
        });

        function main_map_init (map, options) {
            
            L.geoJson({
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [{{object.geoposition.longitude}}, {{object.geoposition.latitude}}]
              },
              "properties": {
                "name": "{% if object.location_name %}{{ object.location_name }}{% else %}{{ object.address }}{% endif %}"
              }
            }, {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {icon: greenIcon});

                }
            }).addTo(map);
            
            //L.marker([{{object.geoposition.latitude}}, {{object.geoposition.longitude}}], {icon: greenIcon}).addTo(map);
            map.setZoom(16);
            map.panTo([{{object.geoposition.latitude}}, {{object.geoposition.longitude}}]);
        }
    </script>
{% endblock %}
